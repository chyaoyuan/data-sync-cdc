import asyncio
import json
import time

import aiofiles
import aiohttp
from aiohttp import ClientSession
from loguru import logger


class Application:
    get_applicant_list_by_project_url = "http://www.linkedin.com/talent/search/api/talentRecruiterSearchHits"
    # data = "decoration=%28entityUrn%2ClinkedInMemberProfileUrn~%28entityUrn%2CreferenceUrn%2Canonymized%2CunobfuscatedFirstName%2CunobfuscatedLastName%2CfirstName%2ClastName%2Cheadline%2Clocation%28displayName%29%2CprofilePicture%2CvectorProfilePicture%2CnumConnections%2Chighlights%28connections%28connections*~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2CtotalCount%29%2CcompanyConnections%28connections*~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2CtotalCount%29%29%2CnetworkDistance%2Cskills*%28skillAssessmentVerified%2CskillAssessmentVerifiedAt%2CskillName%2Cskill%29%2CcanSendInMail%2Cunlinked%2Ceducations*%28school~%28entityUrn%2Cname%29%2CorganizationUrn~%28entityUrn%2Cname%29%2CschoolName%2CdegreeName%2CstartDateOn%2CendDateOn%29%2CworkExperience*%28company~%28entityUrn%2Cname%29%2CcompanyName%2Ctitle%2CstartDateOn%2CendDateOn%29%2CviewerCompanyFollowing%28followingViewerCompany%2CstartedAt%29%2CprivacySettings%28allowConnectionsBrowse%29%2CpublicProfileUrl%2CmemberPreferences%28proxyPhoneNumberAvailability%29%29%2ChiringProjectRecruitingProfile~%28entityUrn%2ChiringContext%2Ccandidate%2CcurrentHiringProjectCandidate%28entityUrn%2CcandidateHiringState%2CcandidateHiringStateUrn~%28entityUrn%2CcustomName%2CstatusType%2CvanityName%29%2ClastModified%2Ccreated%2CaddedToPipeline%28time%2Cactor~%28profile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%29%2ChiringProject~%28entityUrn%2CsourcingChannels*~%28entityUrn%2CchannelType%29%2ChiringProjectMetadata%28created%28time%29%2Cname%2Cstate%2ChiringPipelineEnabled%2Ctitle~%28entityUrn%2CtitleName%29%2Cowner~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2ClocationDescription%2Ccompany~%28entityUrn%2Cname%2CvectorLogo%29%29%2ChiringPipeline~%28entityUrn%2ChiringStates*~%29%2ChiringPipelineDecorated%28entityUrn%2CfullHiringStatesDecorated*%29%29%2CsourcingChannel~%28entityUrn%2CchannelType%29%2CsourcingChannelType%2Csource%2CsourcingChannelUrn%2CcandidateSourceUrn~%28entityUrn%2CdisplayName%2CsourceCategory%29%29%2CstartFollowingCompanyAt%2ClastActivity~%28activityType%2Cperformed%28time%2Cactor~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2CperformedByViewer%2ChiringActivityData%29%2CcandidateMessageThreads*%28subject%2Ccandidate%2CentityUrn%2Cpreview%2ClastInboxSentTime%2CinboxType%2Ccreated%28time%2Cactor~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%29%29%2CreviewNotes*%28reviewRequest%2Creviewer~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2Ccandidate%2Cnote%2CselectedValue%2Ccreated%2ClastModified%2Cdeleted%29%2CopenReviewRequests*%28entityUrn%2Cowner%2Cjob%2CcapProject%2ChiringProject%2Ccandidates%2Creviewers*~%28entityUrn%2Cstate%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2CseatEntitlements%2CseatRoles%2Ccontract%2Cdescription%2CpenaltyBoxInfo%2CentitlementsWithMetadata*%2CproductRestrictions*%29%2ChiringContext%2Cid%2Ccreated%2ClastModified%2Cdeleted%29%2ChiringProjectCandidates*%28entityUrn%2CcandidateHiringState%2CcandidateHiringStateUrn~%28entityUrn%2CcustomName%2CstatusType%2CvanityName%29%2ClastModified%2Ccreated%2CaddedToPipeline%28time%2Cactor~%28profile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%29%2ChiringProject~%28entityUrn%2CsourcingChannels*~%28entityUrn%2CchannelType%29%2ChiringProjectMetadata%28created%28time%29%2Cname%2Cstate%2ChiringPipelineEnabled%2Ctitle~%28entityUrn%2CtitleName%29%2Cowner~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2ClocationDescription%2Ccompany~%28entityUrn%2Cname%2CvectorLogo%29%29%2ChiringPipeline~%28entityUrn%2ChiringStates*~%29%2ChiringPipelineDecorated%28entityUrn%2CfullHiringStatesDecorated*%29%29%2CsourcingChannel~%28entityUrn%2CchannelType%29%2CsourcingChannelType%2Csource%2CsourcingChannelUrn%2CcandidateSourceUrn~%28entityUrn%2CdisplayName%2CsourceCategory%29%29%2CsourcingChannelCandidates*%28applyStarterInfo%2Ccandidate%2Ccreated%2CentityUrn%2ChiringContext%2ClastModified%2CsourcingChannel%2CjobApplicationInfo%28contactEmail%2CcontactPhoneNumber%2Cfeatured%2CjobApplication~%2Csource%29%2CjobPostingRelevanceReasons*%29%2Cmessages*%2Cnotes*%28candidate%2CchildNotes*%28candidate%2CchildNotes*%2Ccontent%2Ccreated%2CentityUrn%2ChiringContext%2ClastModified%2Cowner~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2Cproject%2CmessageModified%2Cmessage%2CparentNote%2Cvisibility%2CsourceType%29%2Ccontent%2Ccreated%2CentityUrn%2ChiringContext%2ClastModified%2Cowner~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2Cproject%2CmessageModified%2Cmessage%2CparentNote%2Cvisibility%2CsourceType%29%2CresumeHiringDocumentsV2s*%2CmessageUrl%2CcandidateFeedbacks*%28entityUrn%2Ccontract%2Ccompany%2ChiringProject~%28entityUrn%2ChiringProjectMetadata%28name%29%29%2CjobTitle%2CjobPosting~%28title%29%2Crequester%2CrequesterRole%2Crequestee~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2Ccandidate%2Cfeedback%28relationship%2Cnote%2CreasonsToNotRecommendCandidate%2CskillFit%29%2Cmessage%2Cstatus%2CwouldRecommend%2Cactive%2ClastModified%2ClastRequestedTimeAt%29%2CcandidateFeedbacksV2*%28active%2CcandidateUrn%2CentityUrn%2Cfeedback%28relationship%2Cnote%2CreasonsToNotRecommendCandidate%2CskillFit%2CreviewNoteSelectedValue%2CwouldRecommend%29%2ChiringProject~%28entityUrn%2ChiringProjectMetadata%28name%29%29%2ChiringProjectUrn%2ClastModified%2Cmessage%2Crequester%2Crequestee~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2CrequesterRole%2Cstatus%29%2CscreenerQuestionAnswers*%2CjobApplicationSkillMatchSummary%28title%2CskillMatchRecords*%28skillMatchState%2CskillUrn~%28skillName%29%29%29%2ChiddenCandidate%2CjobApplications%2CassessedCandidate%28candidateRejectionRecord%2Crejectable%2Cexportable%2CfeaturedSkills*%2CvideoResponses*%29%2CinMailCost%2Ctags*%2CprofileViews*%28entityUrn%2Cseat%29%2CcandidateInsights%28candidateJobPostInsightsUrn~%28targetingCriteriaMatched%2CpositionsInsight%2CyearsOfExperience%2CentityUrn%29%29%2C~hiringProjectCandidatesCount%28paging%29%2C~jobApplicationsCount%28paging%29%29%2CskillsMatchInsightUrn%29&" \
    #        "count=25" \
    #        "&q=jobApplicantSearch" \
    #        "&query=(facetSelections:List((type:SOURCING_CHANNEL,valuesWithSelections:List((value:urn%3Ali%3Ats_sourcing_channel%3A%28urn%3Ali%3Ats_contract%3A207833291%2C3719634819%29,selected:true,negated:false,required:false))),(type:CANDIDATE_HIRING_STATE,valuesWithSelections:List((value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430372047%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430375624%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430374734%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430376619%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430377596%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430373866%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430376618%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430374733%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430372048%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430371113%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430374732%29,selected:true,negated:false,required:false)))),capSearchSortBy:PRESCREENING)&requestParams=(hiringProject:urn%3Ali%3Ats_hiring_project%3A%28urn%3Ali%3Ats_contract%3A207833291%2C{project_id}%29,doFacetCounting:true,doFacetDecoration:true,sourcingChannel:urn%3Ali%3Ats_sourcing_channel%3A%28urn%3Ali%3Ats_contract%3A207833291%2C3719634819%29)" \
    #        "&start={offset}"
    data = "decoration=%28entityUrn%2ClinkedInMemberProfileUrn~%28entityUrn%2CreferenceUrn%2Canonymized%2CunobfuscatedFirstName%2CunobfuscatedLastName%2CfirstName%2ClastName%2Cheadline%2Clocation%28displayName%29%2CprofilePicture%2CvectorProfilePicture%2CnumConnections%2Chighlights%28connections%28connections*~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2CtotalCount%29%2CcompanyConnections%28connections*~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2CtotalCount%29%29%2CnetworkDistance%2Cskills*%28skillAssessmentVerified%2CskillAssessmentVerifiedAt%2CskillName%2Cskill%29%2CcanSendInMail%2Cunlinked%2Ceducations*%28school~%28entityUrn%2Cname%29%2CorganizationUrn~%28entityUrn%2Cname%29%2CschoolName%2CdegreeName%2CstartDateOn%2CendDateOn%29%2CworkExperience*%28company~%28entityUrn%2Cname%29%2CcompanyName%2Ctitle%2CstartDateOn%2CendDateOn%29%2CviewerCompanyFollowing%28followingViewerCompany%2CstartedAt%29%2CprivacySettings%28allowConnectionsBrowse%29%2CpublicProfileUrl%2CmemberPreferences%28proxyPhoneNumberAvailability%29%29%2ChiringProjectRecruitingProfile~%28entityUrn%2ChiringContext%2Ccandidate%2CcurrentHiringProjectCandidate%28entityUrn%2CcandidateHiringState%2CcandidateHiringStateUrn~%28entityUrn%2CcustomName%2CstatusType%2CvanityName%29%2ClastModified%2Ccreated%2CaddedToPipeline%28time%2Cactor~%28profile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%29%2ChiringProject~%28entityUrn%2CsourcingChannels*~%28entityUrn%2CchannelType%29%2ChiringProjectMetadata%28created%28time%29%2Cname%2Cstate%2ChiringPipelineEnabled%2Ctitle~%28entityUrn%2CtitleName%29%2Cowner~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2ClocationDescription%2Ccompany~%28entityUrn%2Cname%2CvectorLogo%29%29%2ChiringPipeline~%28entityUrn%2ChiringStates*~%29%2ChiringPipelineDecorated%28entityUrn%2CfullHiringStatesDecorated*%29%29%2CsourcingChannel~%28entityUrn%2CchannelType%29%2CsourcingChannelType%2Csource%2CsourcingChannelUrn%2CcandidateSourceUrn~%28entityUrn%2CdisplayName%2CsourceCategory%29%29%2CstartFollowingCompanyAt%2ClastActivity~%28activityType%2Cperformed%28time%2Cactor~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2CperformedByViewer%2ChiringActivityData%29%2CcandidateMessageThreads*%28subject%2Ccandidate%2CentityUrn%2Cpreview%2ClastInboxSentTime%2CinboxType%2Ccreated%28time%2Cactor~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%29%29%2CreviewNotes*%28reviewRequest%2Creviewer~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2Ccandidate%2Cnote%2CselectedValue%2Ccreated%2ClastModified%2Cdeleted%29%2CopenReviewRequests*%28entityUrn%2Cowner%2Cjob%2CcapProject%2ChiringProject%2Ccandidates%2Creviewers*~%28entityUrn%2Cstate%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2CseatEntitlements%2CseatRoles%2Ccontract%2Cdescription%2CpenaltyBoxInfo%2CentitlementsWithMetadata*%2CproductRestrictions*%29%2ChiringContext%2Cid%2Ccreated%2ClastModified%2Cdeleted%29%2ChiringProjectCandidates*%28entityUrn%2CcandidateHiringState%2CcandidateHiringStateUrn~%28entityUrn%2CcustomName%2CstatusType%2CvanityName%29%2ClastModified%2Ccreated%2CaddedToPipeline%28time%2Cactor~%28profile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%29%2ChiringProject~%28entityUrn%2CsourcingChannels*~%28entityUrn%2CchannelType%29%2ChiringProjectMetadata%28created%28time%29%2Cname%2Cstate%2ChiringPipelineEnabled%2Ctitle~%28entityUrn%2CtitleName%29%2Cowner~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2ClocationDescription%2Ccompany~%28entityUrn%2Cname%2CvectorLogo%29%29%2ChiringPipeline~%28entityUrn%2ChiringStates*~%29%2ChiringPipelineDecorated%28entityUrn%2CfullHiringStatesDecorated*%29%29%2CsourcingChannel~%28entityUrn%2CchannelType%29%2CsourcingChannelType%2Csource%2CsourcingChannelUrn%2CcandidateSourceUrn~%28entityUrn%2CdisplayName%2CsourceCategory%29%29%2CsourcingChannelCandidates*%28applyStarterInfo%2Ccandidate%2Ccreated%2CentityUrn%2ChiringContext%2ClastModified%2CsourcingChannel%2CjobApplicationInfo%28contactEmail%2CcontactPhoneNumber%2Cfeatured%2CjobApplication~%2Csource%29%2CjobPostingRelevanceReasons*%29%2Cmessages*%2Cnotes*%28candidate%2CchildNotes*%28candidate%2CchildNotes*%2Ccontent%2Ccreated%2CentityUrn%2ChiringContext%2ClastModified%2Cowner~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2Cproject%2CmessageModified%2Cmessage%2CparentNote%2Cvisibility%2CsourceType%29%2Ccontent%2Ccreated%2CentityUrn%2ChiringContext%2ClastModified%2Cowner~%28entityUrn%2Cprofile~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%29%2Cproject%2CmessageModified%2Cmessage%2CparentNote%2Cvisibility%2CsourceType%29%2CresumeHiringDocumentsV2s*%2CmessageUrl%2CcandidateFeedbacks*%28entityUrn%2Ccontract%2Ccompany%2ChiringProject~%28entityUrn%2ChiringProjectMetadata%28name%29%29%2CjobTitle%2CjobPosting~%28title%29%2Crequester%2CrequesterRole%2Crequestee~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2Ccandidate%2Cfeedback%28relationship%2Cnote%2CreasonsToNotRecommendCandidate%2CskillFit%29%2Cmessage%2Cstatus%2CwouldRecommend%2Cactive%2ClastModified%2ClastRequestedTimeAt%29%2CcandidateFeedbacksV2*%28active%2CcandidateUrn%2CentityUrn%2Cfeedback%28relationship%2Cnote%2CreasonsToNotRecommendCandidate%2CskillFit%2CreviewNoteSelectedValue%2CwouldRecommend%29%2ChiringProject~%28entityUrn%2ChiringProjectMetadata%28name%29%29%2ChiringProjectUrn%2ClastModified%2Cmessage%2Crequester%2Crequestee~%28entityUrn%2CfirstName%2ClastName%2Cheadline%2CprofilePicture%2CvectorProfilePicture%2CpublicProfileUrl%2CfollowerCount%2CnetworkDistance%2CautomatedActionProfile%29%2CrequesterRole%2Cstatus%29%2CscreenerQuestionAnswers*%2CjobApplicationSkillMatchSummary%28title%2CskillMatchRecords*%28skillMatchState%2CskillUrn~%28skillName%29%29%29%2ChiddenCandidate%2CjobApplications%2CassessedCandidate%28candidateRejectionRecord%2Crejectable%2Cexportable%2CfeaturedSkills*%2CvideoResponses*%29%2CinMailCost%2Ctags*%2CprofileViews*%28entityUrn%2Cseat%29%2CcandidateInsights%28candidateJobPostInsightsUrn~%28targetingCriteriaMatched%2CpositionsInsight%2CyearsOfExperience%2CentityUrn%29%29%2C~hiringProjectCandidatesCount%28paging%29%2C~jobApplicationsCount%28paging%29%29%2CskillsMatchInsightUrn%29&count=25&q=jobApplicantSearch&query=(facetSelections:List((type:SOURCING_CHANNEL,valuesWithSelections:List((value:urn%3Ali%3Ats_sourcing_channel%3A%28urn%3Ali%3Ats_contract%3A207833291%2C2426761500%29,selected:true,negated:false,required:false))),(type:CANDIDATE_HIRING_STATE,valuesWithSelections:List((value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430372047%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430375624%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430374734%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430376619%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430377596%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430373866%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430376618%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430374733%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430372048%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430371113%29,selected:true,negated:false,required:false),(value:urn%3Ali%3Ats_hiring_state%3A%28urn%3Ali%3Ats_contract%3A207833291%2C10430374732%29,selected:true,negated:false,required:false)))),capSearchSortBy:PRESCREENING)" \
           "&requestParams=(hiringProject:urn%3Ali%3Ats_hiring_project%3A%28urn%3Ali%3Ats_contract%3A207833291%2C{project_id}%29,doFacetCounting:true,doFacetDecoration:true,sourcingChannel:urn%3Ali%3Ats_sourcing_channel%3A%28urn%3Ali%3Ats_contract%3A207833291%2C2426761500%29)" \
           "&start={offset}"
    def __init__(self, session, headers: dict,semaphore):
        self.headers = headers
        self.session = session
        self.semaphore = semaphore

    async def get_applicant_list_by_(self, project_id: str):
        async with self.semaphore:
            elements_list = []
            index = 0
            while True:
                time.sleep(1)
                res = await self.session.post(url=self.get_applicant_list_by_project_url, data=self.data.format(**{"project_id": project_id,"offset": index*25}, ), headers=self.headers)
                status = res.status

                print(await res.json())
                if status == 500:
                    logger.info(f"project_id无->{project_id}")
                    result = {"projectId": project_id, "elements": [],"none":True}
                    async with aiofiles.open(
                            "/Users/chenjiabin/Project/data-sync-cdc/channel/linkedin/applicant/data/project_map_applicant.jsonl",
                            "a") as f:
                        await f.write(json.dumps(result, ensure_ascii=False) + '\n')

                    return False
                if status != 200:
                    logger.error(status)
                    error_cont = await res.text()
                    logger.error(error_cont)
                    quit()
                body = await res.json()
                meta = body["metadata"]
                elements = body.get("elements", [])
                if elements:
                    elements_list = elements_list + elements
                    logger.info(f"project_id->{project_id}  {len(elements)}")
                    index = index + 1
                else:
                    break
            result = {"meta": meta,"projectId":project_id, "elements": elements_list}
            logger.info(f"project_id success->{project_id}  {len(elements_list)}")
            async with aiofiles.open(
                    "/Users/chenjiabin/Project/data-sync-cdc/channel/linkedin/applicant/data/project_map_applicant.jsonl", "a") as f:
                await f.write(json.dumps(result, ensure_ascii=False) + '\n')

async def run():
    _headers = {
        "accept": "application/json",
        "accept-language": "zh-CN,zh;q=0.9",
        "content-type": "application/x-www-form-urlencoded",
        "csrf-token": "ajax:8187577550675074642",
        "sec-ch-ua-mobile": "?0",
        "sec-fetch-dest": "empty",
        "sec-fetch-mode": "cors",
        "sec-fetch-site": "same-origin",
        "x-http-method-override": "GET",
        "x-li-lang": "zh_CN",
        "x-li-page-instance": "urn:li:page:d_talent_talentPool_applicants;RT7cwwlSRvOwLpzIGXMN8Q==",
        "x-li-pem-metadata": "Hiring Platform - Job Applicant / Apply Starters Management=applicants-list",
        "cookie": """bcookie="v=2&eef38a30-d58a-40a5-828b-07eaaab23dd3"; bscookie="v=1&20230625131234c1ec8eca-ffde-440f-8995-f02159c714c0AQGY-egn1l-MvsO24lLgd6XuCc57BNDW"; _gcl_au=1.1.60394227.1687700073; liap=true; JSESSIONID="ajax:8187577550675074642"; u_tz=GMT+0800; li_sugr=5712ddf1-2e1a-41bb-8603-e4f30e555ec0; timezone=Asia/Shanghai; li_theme=light; li_theme_set=app; _guid=fc3c4854-ad38-4420-b0dd-1bbe435829a9; li_cc=AQG6mw51v_jVIwAAAYl3jDvg14xi2qRLiYceXLqnaGe54uwNLBzb0SllLcn8uoGTRLHNubuBC4kC; gpv_pn=business.linkedin.com%2Fzh-cn%2Fproduct-sign-in; li_ep_auth_context=AExhcHA9YWNjb3VudENlbnRlcixhaWQ9MjI5OTE0NixpaWQ9LTEscGlkPTE0MDY4ODAzLGV4cD0xNjkwMTkzNTMzMjU3LGN1cj10cnVlAZ61FoeCFmW6c-i9JOZdCh4yYUYv; aam_uuid=04603882441184570594441513473932382631; s_ips=823; s_tslv=1690164765958; s_tp=1488; mbox=PC#71c1d85d0ee743d181b2c1e37465dc0c.32_0#1705716767|session#af7350565aea436e863791f9c1e2fd29#1690166627; AMCV_14215E3D5995C57C0A495C55%40AdobeOrg=-637568504%7CMCIDTS%7C19563%7CvVersion%7C5.1.1%7CMCMID%7C04809171412315487124425987044269564524%7CMCAAMLH-1690788841%7C11%7CMCAAMB-1690788841%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1690191241s%7CNONE%7CMCCIDH%7C-894394514; li_a=AQJ2PTEmY2FwX3NlYXQ9MTM5NTQzMTkzJmNhcF9hZG1pbj10cnVlJmNhcF9rbj0yMDc4MzMyOTF5PSiCB_HcVsjGxRzTj0R1q7-QNA; cap_session_id=4387653641:1; li_er=v=1&r=urn:li:contract:207833291&t=1688481207464&g=MDIxTpf7S3ooI/Fx/MCKO/rPJ6kx7oPdUA7sQ8jKON68KSg=; li_at=AQEFAHQBAAAAAAvwz_cAAAGJhtPMqAAAAYmvqpSFVgAAF3VybjpsaTptZW1iZXI6MTMyOTY4OTgxmAAKAKpinc3VBLZecQjf8g2E_Zfq9HzB7dMkfbn8Cy7aiuCrAZ1T-1N4VOQOlDz1tgTy34EEnz7yRVj2VjXlCSCW0nqbq7M87nFktTYNka-O3AajA6Xp2autPYm4l8EuQFUq1K2w8AFDAof_S2WKmmCQ0Ukg1DoII8uYFSWNNfwX9CBrtqy-PFmzrx_7AjbLi8J-9A; UserMatchHistory=AQLSo15DKvzSfwAAAYmQn_mZiyYBH5c9e7NLAjOEQq1d-RegpVVdFvmMAn4hbnHI8wohfGWCTiXuf8nDT-9TIWrpj4PHUySKug6FiCOp5DCi29WadDgvuJA54tieQd5i8Z9GmPd_oA3QFXSWuXDT4UOkqb-VsVpOHm4Vsv9Q55xuFOJ_-7ts4tyWwPp_YmZV2BWRy9QOqUXlADYlPYhkOFAYgCcc0-Hq55RrYHSjlj_G9Pw9nLC61XkCa5Jq4EdeOpRbmb-pu839W7q0_ypHj0BnNB_sGBcMJzeG7Fmyly_F1h_T5Cwwlgtl0T34Upn1UkrwQT7jVvCNDNu7D3wbB8U2qs7kXFo; AnalyticsSyncHistory=AQKcgbbEvmyKfAAAAYmQn_mZBHojrTtoNT5EYCruBJxWmHRQC_IQ9Rwn7MLJf4Hha-MxJNDQb-yC35d7MySx2g; lms_ads=AQGp05bIf7HcfAAAAYmQn_tsLAIfqqt5qWdhGP3QaOWnGnIVsnVUZTXPTVtZBq7tSUHI2W7vnmED80egsucsAnwh_1TPgpPs; lms_analytics=AQGp05bIf7HcfAAAAYmQn_tsLAIfqqt5qWdhGP3QaOWnGnIVsnVUZTXPTVtZBq7tSUHI2W7vnmED80egsucsAnwh_1TPgpPs; lang=v=2&lang=zh-cn; lidc="b=OB81:s=O:r=O:a=O:p=O:g=2880:u=304:x=1:i=1690420696:t=1690507096:v=2:sig=AQEzF_XNb28r0EnC8oXbKAMpuPkiW7aI"; sdsc=22%3A1%2C1690431289725%7ECAST%2C0iQr%2BUAtssNUOYnCWHkKMN%2FhtnSo%3D""",
        "x-restli-protocol-version": "2.0.0"
    }
    semaphore = asyncio.Semaphore(1)
    i = "424712884"
    i1 = "834460852"
    async with aiohttp.ClientSession() as session:
        await Application(session, _headers,semaphore).get_applicant_list_by_(i1)
if __name__ == '__main__':
    asyncio.run(run())


